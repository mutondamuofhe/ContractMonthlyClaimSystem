@model ContractMonthlyClaimSystem.Models.ClaimRecord <a!-- Complete Path: ContractMonthlyClaimSystem_starter /Views/Shared/_ClaimCard.cshtml -->

<div class="claim-card card mb-3">
  <div class="card-body">
    <div class="d-flex justify-content-between">
      <div>
        <h5 class="card-title">Claim #@Model.Id — @Model.LecturerId</h5>
        <p class="mb-1">Submitted: @Model.SubmittedAt.ToString("yyyy-MM-dd")</p>
        <p class="mb-1">Hours: @Model.HoursWorked | Rate: @Model.HourlyRate.ToString("C")</p>
        <p class="mb-1">Amount: @Model.CalculatedAmount.ToString("C")</p>
        @if (!string.IsNullOrEmpty(Model.RejectionReason))
        {
            <p class="text-danger small">Rejection reason: @Model.RejectionReason</p>
        }
      </div>

      <div class="text-right">
        <!-- Status badge -->
        @{
            string badge = "secondary";
            string statusText = Model.Status.ToString(); // if enum; adjust if string
            switch (Model.Status)
            {
                case ClaimStatus.Approved:
                    badge = "success"; break;
                case ClaimStatus.Rejected:
                    badge = "danger"; break;
                case ClaimStatus.Escalated:
                    badge = "warning"; break;
                case ClaimStatus.Pending:
                    badge = "info"; break;
                default:
                    badge = "secondary"; break;
            }
        }
        <span class="badge badge-@badge">@statusText</span>

        <!-- Last processed info -->
        @if (Model.StatusUpdatedAt != null)
        {
            <div class="small mt-1">Processed: @Model.StatusUpdatedAt?.ToString("yyyy-MM-dd HH:mm")</div>
            <div class="small">By: @Model.StatusUpdatedBy</div>
        }
      </div>
    </div>

    <div class="mt-3 d-flex gap-2">
      <!-- AutoCheck button (calls AutoProcess) -->
      <form asp-controller="Coordinator" asp-action="AutoProcess" method="post" class="d-inline">
        @Html.AntiForgeryToken()
        <input type="hidden" name="id" value="@Model.Id" />
        <button class="btn btn-outline-primary btn-sm" type="submit">Auto Check</button>
      </form>

      <!-- Approve button - shown to coordinators & managers -->
      @if (User.IsInRole("ProgrammeCoordinator") || User.IsInRole("AcademicManager"))
      {
        <form asp-controller="Coordinator" asp-action="Approve" method="post" class="d-inline" onsubmit="return confirmApprove();">
          @Html.AntiForgeryToken()
          <input type="hidden" name="id" value="@Model.Id" />
          <button class="btn btn-success btn-sm" type="submit">Approve</button>
        </form>

        <!-- Reject with small modal/input or prompt -->
        <form asp-controller="Coordinator" asp-action="Reject" method="post" class="d-inline" onsubmit="return confirmReject(this);">
          @Html.AntiForgeryToken()
          <input type="hidden" name="id" value="@Model.Id" />
          <input type="hidden" name="reason" class="reject-reason" />
          <button type="submit" class="btn btn-danger btn-sm">Reject</button>
        </form>
      }
    </div>
  </div>
</div>

